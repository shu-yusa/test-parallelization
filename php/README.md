# PHP test parallelization sample
PHP version of test parallelization.

## PHP Version
* PHP 8.0, 8.1

## Test execution
To run tests,
```bash
./vendor/bin/phpunit
```
By default, it runs tests with 4 processes. One will see a result like
```
PHPUnit 9.5.24 #StandWithUkraine

[Grouped Tests]
Group-0: 50 classes, 325 cases
Group-1: 50 classes, 325 cases
Group-2: 50 classes, 325 cases
Group-3: 50 classes, 326 cases
PHPUnit 9.5.24 #StandWithUkraine

...............................................................  63 / 325 ( 19%)
............................................................... 126 / 325 ( 38%)
............................................................... 189 / 325 ( 58%)
............................................................... 252 / 325 ( 77%)
............................................................... 315 / 325 ( 96%)
..........                                                      325 / 325 (100%)

Time: 00:01.346, Memory: 16.00 MB

OK (325 tests, 325 assertions)
PHPUnit 9.5.24 #StandWithUkraine

...............................................................  63 / 325 ( 19%)
............................................................... 126 / 325 ( 38%)
............................................................... 189 / 325 ( 58%)
............................................................... 252 / 325 ( 77%)
............................................................... 315 / 325 ( 96%)
..........                                                      325 / 325 (100%)

Time: 00:01.347, Memory: 16.00 MB

OK (325 tests, 325 assertions)
PHPUnit 9.5.24 #StandWithUkraine

...............................................................  63 / 325 ( 19%)
............................................................... 126 / 325 ( 38%)
............................................................... 189 / 325 ( 58%)
............................................................... 252 / 325 ( 77%)
............................................................... 315 / 325 ( 96%)
..........                                                      325 / 325 (100%)

Time: 00:01.348, Memory: 16.00 MB

OK (325 tests, 325 assertions)
PHPUnit 9.5.24 #StandWithUkraine

...............................................................  63 / 326 ( 19%)
............................................................... 126 / 326 ( 38%)
............................................................... 189 / 326 ( 57%)
............................................................... 252 / 326 ( 77%)
............................................................... 315 / 326 ( 96%)
...........                                                     326 / 326 (100%)

Time: 00:01.349, Memory: 16.00 MB

OK (326 tests, 326 assertions)
.                                                                   1 / 1 (100%)
[Test Results]
Group-0: OK
Group-1: OK
Group-2: OK
Group-3: OK


Time: 00:01.400, Memory: 14.00 MB

OK (1 test, 1 assertion)
```

In this sample, dummy test codes are accommodated in tests/ folder, which can regenerated by
```bash
# one can sepcify the number of generated classes inside the script
php DummyTestGenerator.php
```

With giving an environment variable, one can overwrite the parallelization factor
```bash
NUM_PARALLELIZATION=8 ./vendor/bin/phpunit
```
There is another available environment variable called `TEST_GROUP_INDICES`. 
This variable is supposed to have comma-separated integers, and when this is specified,
executed test groups are picked up by these indices.
For example, if you run as follows,

```bash
TEST_GROUP_INDICES=0,1 ./vendor/bin/phpunit
```

you will see a result like 
```
PHPUnit 9.5.24 #StandWithUkraine

[Grouped Tests]
Group-0: 50 classes, 325 cases
Group-1: 50 classes, 325 cases
PHPUnit 9.5.24 #StandWithUkraine

...............................................................  63 / 325 ( 19%)
............................................................... 126 / 325 ( 38%)
............................................................... 189 / 325 ( 58%)
............................................................... 252 / 325 ( 77%)
............................................................... 315 / 325 ( 96%)
..........                                                      325 / 325 (100%)

Time: 00:01.311, Memory: 16.00 MB

OK (325 tests, 325 assertions)
PHPUnit 9.5.24 #StandWithUkraine

...............................................................  63 / 325 ( 19%)
............................................................... 126 / 325 ( 38%)
............................................................... 189 / 325 ( 58%)
............................................................... 252 / 325 ( 77%)
............................................................... 315 / 325 ( 96%)
..........                                                      325 / 325 (100%)

Time: 00:01.314, Memory: 16.00 MB

OK (325 tests, 325 assertions)
.                                                                   1 / 1 (100%)
[Test Results]
Group-0: OK
Group-1: OK


Time: 00:01.364, Memory: 14.00 MB

OK (1 test, 1 assertion)
```
This variable is intended for the parallelization in GitHub Actions.

## GitHub Actions
The sample uses the matrix feature to parallelize the test execution in GitHub Actions. One can update the parameters in the GitHub Actions config file in order to change the parallelization factor.
